<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="../libs/build/three.js"></script>
    <script src="../libs/tools/dat.gui.js"></script>
    <script src="../libs/tools/stats.min.js"></script>
    <title>add Cude</title>
    <style>
        body{margin:0;overflow: hidden;}
    </style>
</head>
<body>
    <div id="GL"></div>
    <div id="stats"></div>
    <script>
        var ctrl = {}
        var flag = false
        var button, startX, startY,startZ
        var scene = new THREE.Scene()
        var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, .1, 1000)
        camera.position.x = -30
        camera.position.y = 30
        camera.position.z = 50
        camera.lookAt(scene.position)
        scene.add(camera)

        scene.fog = new THREE.Fog(0xffffff, .015, 1000)
        var renderer = new THREE.WebGLRenderer()
        renderer.setClearColor(0xeeeeee)
        renderer.setSize(window.innerWidth, window.innerHeight)
        renderer.shadowMapEnabled = true

        var bigObj = new THREE.Object3D()

        var planeG = new THREE.PlaneGeometry(60, 30, 1, 1)
        var planeM = new THREE.MeshLambertMaterial({color: 0xdddddd})
        var plane = new THREE.Mesh(planeG, planeM)
        plane.rotation.x = -.5 * Math.PI
        plane.receiveShadow = true
        bigObj.add(plane)
        // scene.add(plane)

        var spot = new THREE.SpotLight(0xffffff)
        spot.position.set(-40, 60, -10)
        spot.castShadow = true
        bigObj.add(spot)
        scene.add(bigObj)
        document.querySelector('#GL').appendChild(renderer.domElement)
        // renderer.render(scene, camera)
        function animate() {
            stats.update()
            // camera.position.x = ctrl.camerax || -30
            // camera.position.y = ctrl.cameray || 30
            // camera.position.z = ctrl.cameraz || 40
            // camera.lookAt(scene.position)
            scene.traverse(function (e) {
                if (e instanceof THREE.Mesh && e !== plane) {
                    e.rotation.x += Math.random() * ctrl.rotationSpeed
                    e.rotation.y += Math.random() * ctrl.rotationSpeed
                    e.rotation.z += Math.random() * ctrl.rotationSpeed
                }
            })
            renderer.render(scene, camera)
            requestAnimationFrame(animate)
        }
        ctrl = new function() {
            this.rotationSpeed = 0.02
            this.camerax = -30
            this.cameray = 30
            this.cameraz = 50
            this.objs = 0
            this.addCube = function () {
                var l = Math.ceil(Math.random() * 3)
                var cubeG = new THREE.BoxGeometry(l, l, l)
                var cubeM = new THREE.MeshLambertMaterial({
                    color: (Math.random() * .5 + .5) *  0xffffff
                })
                var cube = new THREE.Mesh(cubeG, cubeM)
                cube.castShadow = true
                cube.name = 'cube' + scene.children.length
                cube.position.x = 60 * (Math.random() - .5)
                cube.position.y = 5 * (Math.random())
                cube.position.z = 30 * (Math.random() - .5)
                cube.rotation.x = 2 * Math.random() * Math.PI
                cube.rotation.y = 2 * Math.random() * Math.PI
                cube.rotation.z = 2 * Math.random() * Math.PI
                bigObj.add(cube)
                this.objs = scene.children.length
            }
        }
        var gui = new DAT.GUI()
        gui.add(ctrl, 'rotationSpeed', 0, 1)
        gui.add(ctrl, 'camerax', -100, 100)
        gui.add(ctrl, 'cameray', -100, 100)
        gui.add(ctrl, 'cameraz', -100, 100)
        gui.add(ctrl, 'addCube')
        gui.add(ctrl, 'objs').listen()
        var stats = new Stats()
        stats.setMode(0)
        stats.domElement.style.position = 'absolute'
        stats.domElement.style.right = '0'
        stats.domElement.style.top = '200px'

        document.querySelector("#stats").appendChild(stats.domElement)
        animate()
        window.addEventListener('mousedown', function (e) {
				flag = true
				button = e.button
				startX = e.clientX
                startY = e.clientY
                startZ = 0
			})
        window.addEventListener('mousemove', function (e) {
            if ( !flag ) return
            if ( button === 0 ) {
                bigObj.position.x += (e.clientX - startX) / 1000
                startX = e.clientX
                bigObj.position.y -= (e.clientY - startY) / 1000
                startY = e.clientY
            } else if ( button === 2) {
                camera.position.x += Math.sin((e.clientX - startX) / 1000)
                // camera.position.y += (e.clientY - startY) / 1000
                // startY = e.clientY
                if (camera.position.z <= 0) {
                    i = 1
                }else if (camera.position.z >= 50) {
                    i = -1
                }
                camera.position.z -= i * Math.cos((e.clientX - startX) / 1000)
                startX = e.clientX
                // startZ = e.clientZ
                camera.lookAt(scene.position)
            }
        })
        window.addEventListener('mouseup', function () {
            flag = false
        })
        window.addEventListener('wheel', function (e) {
            console.log(e.deltaY)
            camera.position.z += e.deltaY / 50
        })
        window.oncontextmenu = function (e) {
            e.preventDefault()
        }
    </script>
</body>
</html>